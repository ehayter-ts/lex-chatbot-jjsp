!function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n={},i=e((function(e,i){e.exports=function(){var e=e||function(e,i){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==t&&t.crypto&&(r=t.crypto),!r)try{r=n}catch(t){}var o=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),a={},u=a.lib={},c=u.Base={extend:function(t){var e=s(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},p=u.WordArray=c.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes,r=t.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var s=n[o>>>2]>>>24-o%4*8&255;e[i+o>>>2]|=s<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)e[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(o());return new p.init(e,t)}}),f=a.enc={},h=f.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var o=e[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new p.init(n,e/2)}},d=f.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var o=e[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new p.init(n,e)}},l=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(d.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return d.parse(unescape(encodeURIComponent(t)))}},y=u.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var n,i=this._data,r=i.words,o=i.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,c=e.min(4*u,o);if(u){for(var f=0;f<u;f+=s)this._doProcessBlock(r,f);n=r.splice(0,u),i.sigBytes-=c}return new p.init(n,c)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),g=(u.Hasher=y.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new g.HMAC.init(t,n).finalize(e)}}}),a.algo={});return a}(Math);return e}()}));e((function(t,e){t.exports=function(t){return function(e){var n=t,i=n.lib,r=i.WordArray,o=i.Hasher,s=n.algo,a=[],u=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var i=2,r=0;r<64;)t(i)&&(r<8&&(a[r]=n(e.pow(i,.5))),u[r]=n(e.pow(i,1/3)),r++),i++}();var c=[],p=s.SHA256=o.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],p=n[5],f=n[6],h=n[7],d=0;d<64;d++){if(d<16)c[d]=0|t[e+d];else{var l=c[d-15],y=(l<<25|l>>>7)^(l<<14|l>>>18)^l>>>3,g=c[d-2],m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[d]=y+c[d-7]+m+c[d-16]}var w=i&r^i&o^r&o,v=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),x=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&p^~a&f)+u[d]+c[d];h=f,f=p,p=a,a=s+x|0,s=o,o=r,r=i,i=x+(v+w)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+p|0,n[6]=n[6]+f|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=o._createHelper(p),n.HmacSHA256=o._createHmacHelper(p)}(Math),t.SHA256}(i)})),e((function(t,e){t.exports=function(t){var e,n,i;n=(e=t).lib.Base,i=e.enc.Utf8,e.algo.HMAC=n.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=i.parse(e));var n=t.blockSize,r=4*n;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var o=this._oKey=e.clone(),s=this._iKey=e.clone(),a=o.words,u=s.words,c=0;c<n;c++)a[c]^=1549556828,u[c]^=909522486;o.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(n))}})}(i)})),e((function(t,e){t.exports=function(t){return t.HmacSHA256}(i)}));metadata={systemName:"AWS_Lex_ChatBot",displayName:"AWS Lex ChatBot Broker",description:"AWS Lex ChatBot Broker",configuration:{AwsRegion:{displayName:"AWS Region",type:"string",value:"eu-west-2"},BotName:{displayName:"Bot Name",type:"string",value:"MedicalBotNHS"},BotAlias:{displayName:"Bot Name",type:"string",value:"latestversion"},UserID:{displayName:"User ID",type:"string",value:"AKIARXLDA4AZB24QPA72"},UserSecret:{displayName:"User Secret",type:"string",value:""}}},ondescribe=async function({}){postSchema({objects:{message:{displayName:"Message",description:"Represents a text reply",properties:{inputText:{displayName:"Input Text",type:"string"},outputText:{displayName:"Output Text",type:"string"}},methods:{postText:{displayName:"Post Text",type:"execute",inputs:["inputText"],outputs:["outputText"]}}}}})},onexecute=async function({objectName:t,methodName:e,parameters:n,properties:i,configuration:r}){switch(t){case"message":await async function(t,e,n){switch(t){case"postText":await function(t,e){return new Promise((n,i)=>{var r,o={inputText:t.inputText.toString()},s=JSON.stringify(o),a=function(t){for(var e=[":","-"],n=0;n<e.length;n++)for(;-1!=t.indexOf(e[n]);)t=t.replace(e[n],"");return t=t.split(".")[0]+"Z"}((new Date).toISOString()),u=a.split("T")[0],c=(r=(void 0)(u,"AWS4"+metadata.configuration.UserSecret),(void 0)("aws4_request",(void 0)("lex",(void 0)(metadata.configuration.AwsRegion.toString(),r)))),p=(void 0)(s,c),f=`runtime.lex.${e.AwsRegion}.amazonaws.com`,h=(void 0)(s).toString(),d=`/bot/${e.BotName}/alias/${e.BotAlias}/user/${e.UserID}/text HTTP/1.1`,l=`AWS4-HMAC-SHA256 Credential=${e.UserID.toString()}/${u}/${e.AwsRegion.toString()}/lex/aws4_request, SignedHeaders=content-type;host;x-amz-content-sha256;x-amz-date, Signature=${p}`,y=`https://runtime.lex.${e.AwsRegion}.amazonaws.com/bot/${e.BotName}/alias/${e.BotAlias}/user/${e.UserID}/text`,g="POST\n"+d+"\n\ncontent-type:application/json\nhost:"+f+"\nx-amz-content-sha256:"+h+"\nx-amz-date:"+a+"\ncontent-type;host;x-amz-content-sha256;x-amz-date\n"+h,m=(void 0)(g).toString(),w="AWS4-HMAC-SHA256\n"+a+"\n"+u+"/"+e.AwsRegion+"/lex/aws4_request\n"+m,v=(p=(void 0)(c,w),new XMLHttpRequest);v.onreadystatechange=function(){try{if(4!==v.readyState)return;if(200!==v.status)throw new Error("Failed with status "+v.status);var t=JSON.parse(v.responseText);postResult({outputText:t.message}),n()}catch(t){postResult({outputText:`ErrorMessage: ${t.message}\nHeader: ${l}\nURL: ${y}\nSignature: ${c}\nBodyHash: ${h}\nAmzDate: ${a}\nAuthDate: ${u}\nCanonicalReq: ${g}\nAuthKey: ${p}\nCanonicalHash: ${m}\nStringToSign: ${w}`}),n()}},v.open("POST",y),v.setRequestHeader("Authorization",l),v.setRequestHeader("Content-Type","application/json"),v.setRequestHeader("Host",f),v.setRequestHeader("X-Amz-Date",a),v.setRequestHeader("X-Amz-Content-SHA256",h),v.setRequestHeader("Content-Length",(s.length-2).toString()),v.send(s)})}(e,n);break;default:throw new Error("The method "+t+" is not supported.")}}(e,i,r);break;default:throw new Error("The object "+t+" is not supported.")}}}();
//# sourceMappingURL=index.js.map
